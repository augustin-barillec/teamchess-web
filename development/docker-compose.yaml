services:
  # ✨ NEW: The Master Server
  master-server:
    build:
      context: ..
      dockerfile: master-server/Dockerfile
    container_name: teamchess-master
    restart: unless-stopped
    ports:
      - "4000:4000" # Expose master server API
    logging: &logging_defaults
      driver: "json-file"
      options:
        max-size: "10m"
        max-file: "3"

  # ✏️ MODIFIED: This is now Game Server 1
  game-server-1:
    build:
      context: ..
      dockerfile: server/Dockerfile
    container_name: teamchess-server-1
    restart: unless-stopped
    ports:
      - "3001:3001"
    environment:
      - NODE_ENV=production
      - MASTER_SERVER_URL=http://master-server:4000
      - PUBLIC_ADDRESS=ws://localhost:3001
      - SERVER_NAME=Local Server Alpha
    logging: *logging_defaults

  # ✨ NEW: This is Game Server 2
  game-server-2:
    build:
      context: ..
      dockerfile: server/Dockerfile
    container_name: teamchess-server-2
    restart: unless-stopped
    ports:
      - "3002:3001" # Host port 3002 maps to container port 3001
    environment:
      - NODE_ENV=production
      - MASTER_SERVER_URL=http://master-server:4000
      - PUBLIC_ADDRESS=ws://localhost:3002
      - SERVER_NAME=Local Server Bravo
    logging: *logging_defaults

  # ✏️ MODIFIED: The client no longer depends directly on one server
  client:
    build:
      context: ..
      dockerfile: client/Dockerfile
    container_name: teamchess-client
    restart: unless-stopped
    ports:
      - "80:80"
    # depends_on is removed
    logging: *logging_defaults