# server/deploy/fleet.yaml
apiVersion: "agones.dev/v1"
kind: Fleet
metadata:
  name: teamchess-fleet
  namespace: default
spec:
  replicas: 5 # Keep 5 game servers warm and ready for players
  strategy:
    type: RollingUpdate
    rollingUpdate:
      maxSurge: 25%
      maxUnavailable: 25%
  template:
    spec:
      ports:
      - name: default
        # Agones will dynamically assign a port from the host node's available range.
        # This is the standard and most scalable approach.
        portPolicy: Dynamic
        containerPort: 3001 # The port your Node.js app listens on
      template:
        spec:
          containers:
          - name: teamchess-server
            # IMPORTANT: Replace with your actual image path in Artifact Registry
            image: europe-west1-docker.pkg.dev/YOUR_PROJECT_ID/teamchess-repo/game-server:latest
            resources:
              requests:
                memory: "128Mi"
                cpu: "100m" # 0.1 vCPU
              limits:
                memory: "256Mi"
                cpu: "500m" # 0.5 vCPU